# 비동기 에러 처리시에는 async-await 혹은 promise를 사용하라

### 한 문단 설명

콜백은 대부분의 프로그래머와 친하지 않기 때문에 잘 확장되지 않는다. 그것들은 에러를 전체적으로 확인하게 하고, 추잡한 코드 중첩을 다루게 하고, 코드 흐름에 대해 추론하기 어렵게 만든다. BlueBird, async, Q와 같은 Promise 라이브러리는 RETURN과 THROW를 사용하여 프로그램 흐름을 제어하는 표준 코드 스타일을 가진다. 특히, 기본 코드 경로가 모든 함수의 에러를 처리하지 않도록 가장 선호하는 try-catch 에러 처리 스타일을 지원한다.

### 코드 예시 - promise를 사용하여 에러 잡기

```javascript
doWork()
 .then(doWork)
 .then(doOtherWork)
 .then((result) => doWork)
 .catch((error) => {throw error;})
 .then(verify);
```

### 안티 패턴 코드 예시 – 콜백 스타일 에러 처리

```javascript
getData(someParameter, function(err, result) {
    if(err !== null) {
        // 주어진 콜백 함수를 호출하는 것과 같은 작업을 수행하고 오류를 전달한다.
        getMoreData(a, function(err, result) {
            if(err !== null) {
                // 주어진 콜백 함수를 호출하는 것과 같은 작업을 수행하고 오류를 전달한다.
                getMoreData(b, function(c) {
                    getMoreData(d, function(e) {
                        if(err !== null ) {
                            // 감이 잡히는가?
                        }
                    })
                });
            }
        });
    }
});
```

### 블로그 인용: "promise는 문제를 가지고 있다"

 pouchdb.com 블로그에서
 
 > 사실 콜백은 훨씬 더 불길한 일을 한다. 콜백은 우리가 프로그래밍 언어에서 일반적으로 당연하게 여기는 스택을 허용하지 않는다. 스택 없이 코드를 작성하는 것은 브레이크 없이 자동차를 운전하는 것과 비슷하다. 당신이 그것을 위해 애를 쓰고 그것이 없을 때까지 그것이 얼마나 절실히 필요한지 깨닫지 못한다. Promise의 핵심은 우리가 비동기식으로 돌아갔을 때 잃었던 언어 기본 요소인 return, throw 및 스택을 다시 제공하는 것이다. 그러나 당신들이 promise를 활용하려면 올바르게 사용하는 방법을 알아야 한다.

### 블로그 인용: "promise 방식이 훨씬 더 간결하다"

 gosquared.com 블로그에서

 > promise 방식이 훨씬 더 간결하고 명확하며 빠르게 작성할 수 있다. 작업 내에서 에러나 예외가 발생하면 단일 .catch() 핸들러에 의해 처리된다. 모든 에러를 처리할 수 있는 단일 장소가 있다는 것은 작업의 각 단계에 대해 에러 검사를 할 필요가 없다는 것을 의미한다.

### 블로그 인용: "promise는 네이티브 ES6이며, 생성자와 함께 사용할 수 있다"

 StrongLoop 블로그에서

 > 콜백은 에러 처리가 엉망이다. promise가 더 좋다. Express에 내장된 에러 처리를 promise와 결합하고 잡을 수 없는 예외의 가능성을 크게 낮춘다. promise는 네이티브 ES6이며 생성자와 함께 사용할 수 있고, Babel 같은 컴파일러를 통해 async/await와 같은 ES7 제안을 사용할 수 있다. 

### 블로그 인용문: "당신에게 익숙한 모든 일반 흐름 제어 구조는 완전히 망가졌다"

Benno’s 블로그에서
 
 > 비동기식 콜백 기반 프로그래밍의 가장 좋은 점 중 하나는 기본적으로 당신이 익숙한 모든 규칙적인 흐름 제어 구조가 완전히 무너졌다는 것이다. 하지만, 가장 무너진 것은 예외 처리이다. Javascript는 예외 처리하기 위한 꽤 익숙한 try...catch 구조를 제공한다. 예외가 있는 문제는 콜 스택에서 오류를 짧게 줄일 수 있는 좋은 방법을 제공하지만 다른 스택에서 오류가 발생할 경우 완전히 무용지물이 된다는 것이다.

